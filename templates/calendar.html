<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Existing head content] -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Calendar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="container mx-auto px-4 py-6">
  {% for month in months_data %}
    <h1 class="text-3xl font-bold text-center mb-8">{{ month.year }} / {{ month.month }}</h1>

    <!-- Calendar Header (Days of the Week) -->
    <div class="grid grid-cols-7 gap-2 text-center font-semibold">
      <div>Mon</div>
      <div>Tue</div>
      <div>Wed</div>
      <div>Thu</div>
      <div>Fri</div>
      <div>Sat</div>
      <div>Sun</div>
    </div>

    <!-- Calendar Grid -->
    <div class="grid grid-cols-7 gap-2 mt-4">
      {% set first_day_of_month = datetime(month.year, month.month, 1) %}
      {% set first_weekday = first_day_of_month.weekday() %}

      <!-- Empty Cells for days before the first of the month -->
      {% for _ in range(first_weekday) %}
        <div class="p-4 bg-gray-200 h-32"></div>
      {% endfor %}

      <!-- Days with events -->
      {% for day in range(1, month.last_day_of_month + 1) %}
        {% set current_date = datetime(month.year, month.month, day).date() %}
        <div class="p-4 bg-white shadow rounded-md h-32 overflow-y-auto">
          <span class="font-bold">{{ day }}</span>
          <div class="mt-2 text-xs">
            {% if current_date in grouped_events %}
              <!-- Display events for this day -->
              {% for event in grouped_events[current_date] %}
                <p class="event-item cursor-pointer text-blue-500 underline"
                   data-event-id="{{ event.id }}"
                   data-event-name="{{ event.name|e }}"
                   data-event-date="{{ event.date.strftime('%Y-%m-%d') }}"
                   data-event-doors="{{ event.doors.strftime('%H:%M') }}"
                   data-venue-name="{{ event.venue_name|e }}"
                   data-venue-address="{{ event.venue_address|e }}"
                   data-venue-city="{{ event.venue_city|e }}"
                   data-venue-canton="{{ event.venue_canton|e }}"
                   data-venue-plz="{{ event.venue_plz|e }}"
                   data-ticket-price="{{ event.ticket_price|e }}"
                   data-ticket-link="{{ event.ticket_link|e }}"
                   data-venue-coords="{{ event.venue_coords|e }}"
                   data-genre="{{ event.genre|e }}"
                   data-acts="{{ event.acts|e }}"
                   data-flyer="{{ event.flyer|e }}"
                   onclick="showEventDetails(this)">
                  {{ event.name }}, {{ event.venue_canton }}
                </p>
              {% endfor %}
            {% else %}
              <p>No events</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}

      <!-- Empty Cells for days after the last of the month -->
      {% set last_day_of_week = datetime(month.year, month.month, month.last_day_of_month).weekday() %}
      {% for _ in range(6 - last_day_of_week) %}
        <div class="p-4 bg-gray-200 h-32"></div>
      {% endfor %}
    </div>
    <br>
    <br>
  {% endfor %}
</div>

<!-- Modal -->
<div id="event-modal" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 hidden">
  <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 md:w-1/2">
    <h2 id="modal-event-name" class="text-2xl font-bold mb-4">Event Name</h2>
    <p id="modal-event-date" class="mb-2">Date: </p>
    <p id="modal-event-venue" class="mb-2">Venue: </p>
    <p id="modal-event-address" class="mb-2">Address: </p>
    <p id="modal-event-city" class="mb-2">City: </p>
    <p id="modal-event-genre" class="mb-2">Genre: </p>
    <p id="modal-event-acts" class="mb-2">Acts: </p>
    <p id="modal-event-ticket-price" class="mb-2">Ticket Price: </p>
    <p id="modal-event-ticket-link" class="mb-2">Ticket Link: </p>
    <!-- Add other event details as needed -->
    <button onclick="closeModal()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">Close</button>
  </div>
</div>

<!-- JavaScript -->
<script>
  function showEventDetails(element) {
    // Retrieve data from data attributes
    var eventName = element.getAttribute('data-event-name');
    var eventDate = element.getAttribute('data-event-date');
    var eventDoors = element.getAttribute('data-event-doors');
    var venueName = element.getAttribute('data-venue-name');
    var venueAddress = element.getAttribute('data-venue-address');
    var venueCity = element.getAttribute('data-venue-city');
    var venueCanton = element.getAttribute('data-venue-canton');
    var venuePLZ = element.getAttribute('data-venue-plz');
    var ticketPrice = element.getAttribute('data-ticket-price');
    var ticketLink = element.getAttribute('data-ticket-link');
    var venueCoords = element.getAttribute('data-venue-coords');
    var genre = element.getAttribute('data-genre');
    var acts = element.getAttribute('data-acts');
    var flyer = element.getAttribute('data-flyer');

    // Set the modal content
    document.getElementById('modal-event-name').textContent = eventName;
    document.getElementById('modal-event-date').textContent = 'Date: ' + eventDate + ' at ' + eventDoors;
    document.getElementById('modal-event-venue').textContent = 'Venue: ' + venueName;
    document.getElementById('modal-event-address').textContent = 'Address: ' + venueAddress;
    document.getElementById('modal-event-city').textContent = 'City: ' + venuePLZ + ' ' + venueCity + ', ' + venueCanton ;
    document.getElementById('modal-event-genre').textContent = 'Genre: ' + genre;
    document.getElementById('modal-event-acts').textContent = 'Acts: ' + acts;
    document.getElementById('modal-event-ticket-price').textContent = 'Ticket Price: ' + ticketPrice;

    // Handle ticket link
    if(ticketLink){
        document.getElementById('modal-event-ticket-link').innerHTML = 'Ticket Link: <a href="' + ticketLink + '" target="_blank" class="text-blue-500 underline">' + ticketLink + '</a>';
    } else {
        document.getElementById('modal-event-ticket-link').textContent = 'Ticket Link: N/A';
    }

    // Show the modal
    document.getElementById('event-modal').classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('event-modal').classList.add('hidden');
  }
</script>

</body>
</html>
